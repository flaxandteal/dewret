
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.4">
    
    
      
        <title>Workflows - dewret</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.80dcb947.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#workflows" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="dewret" class="md-header__button md-logo" aria-label="dewret" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dewret
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Workflows
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/flaxandteal/dewret" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dewret
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="dewret" class="md-nav__button md-logo" aria-label="dewret" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    dewret
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flaxandteal/dewret" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dewret
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../comparison/" class="md-nav__link">
        Comparison
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../eager_execution/" class="md-nav__link">
        Eager Execution
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../renderer_tutorial/" class="md-nav__link">
        Renderer Tutorial
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../renderers/" class="md-nav__link">
        Renderers
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Workflows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Workflows
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nested-tasks" class="md-nav__link">
    Nested tasks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-output-fields" class="md-nav__link">
    Step Output Fields
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subworkflow" class="md-nav__link">
    Subworkflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-factories" class="md-nav__link">
    Input Factories
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_1" type="checkbox" id="__nav_10_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10_1">
          Dewret
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Dewret" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_1">
          <span class="md-nav__icon md-icon"></span>
          Dewret
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/annotations/" class="md-nav__link">
        Annotations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/cli/" class="md-nav__link">
        CLI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/core/" class="md-nav__link">
        Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/render/" class="md-nav__link">
        Render
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/tasks/" class="md-nav__link">
        Tasks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/workflow/" class="md-nav__link">
        Workflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_1_9" type="checkbox" id="__nav_10_1_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10_1_9">
          Backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Backends" data-md-level="3">
        <label class="md-nav__title" for="__nav_10_1_9">
          <span class="md-nav__icon md-icon"></span>
          Backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/backends/backend_dask/" class="md-nav__link">
        Backend Dask
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/backends/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_1_10" type="checkbox" id="__nav_10_1_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10_1_10">
          Renderers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Renderers" data-md-level="3">
        <label class="md-nav__title" for="__nav_10_1_10">
          <span class="md-nav__icon md-icon"></span>
          Renderers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/renderers/cwl/" class="md-nav__link">
        Cwl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/renderers/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dewret/renderers/snakemake/" class="md-nav__link">
        Snakemake
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    Description
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nested-tasks" class="md-nav__link">
    Nested tasks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-output-fields" class="md-nav__link">
    Step Output Fields
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subworkflow" class="md-nav__link">
    Subworkflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input-factories" class="md-nav__link">
    Input Factories
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/flaxandteal/dewret/edit/main/docs/workflows.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="workflows">Workflows</h1>
<h2 id="description">Description</h2>
<p>A dewret workflow is composed of one or more steps that may make use of both local and global parameters. Each step is defined by a dewret task that is created by using the @task() decorator, and each task may be used by multiple steps.</p>
<h2 id="setup">Setup</h2>
<p>We can pull in dewret tools to produce CWL with a small number of imports.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">construct</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">param</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
</code></pre></div>
<h2 id="dependencies">Dependencies</h2>
<p>Specifying step interdependencies is possible by combining lazy-evaluated function
calls. The output series of steps is not guaranteed to be in order of execution.</p>
<p>Dewret hashes the parameters to identify and unify steps. This lets you do, for example:</p>
<pre class="mermaid"><code>graph TD
    A[increment] --&gt; B[double]
    A[increment] --&gt; C[mod10]
    B[double] --&gt; D[sum]
    C[mod10] --&gt; D[sum]</code></pre>
<p>In code, this would be:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">construct</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">increment</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Increment an integer.&quot;&quot;&quot;</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">double</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Double an integer.&quot;&quot;&quot;</span>
<span class="o">...</span>     <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">num</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">mod10</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Take num mod 10.&quot;&quot;&quot;</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Add two integers.&quot;&quot;&quot;</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">left</span><span class="o">=</span><span class="n">double</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">increment</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">23</span><span class="p">)),</span>
<span class="o">...</span>     <span class="n">right</span><span class="o">=</span><span class="n">mod10</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">increment</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">23</span><span class="p">))</span>
<span class="o">...</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wkflw</span> <span class="o">=</span> <span class="n">construct</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">simplify_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cwl</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">wkflw</span><span class="p">)[</span><span class="s2">&quot;__root__&quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cwl</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">class</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">cwlVersion</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.2</span>
<span class="n">inputs</span><span class="p">:</span>
  <span class="n">increment</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">num</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">23</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">num</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">outputs</span><span class="p">:</span>
  <span class="n">out</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">out</span>
    <span class="n">outputSource</span><span class="p">:</span> <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">steps</span><span class="p">:</span>
  <span class="n">double</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">num</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">increment</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">double</span>
  <span class="n">increment</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">num</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">increment</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">num</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">increment</span>
  <span class="n">mod10</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">num</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">increment</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">mod10</span>
  <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">left</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">double</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
      <span class="n">right</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">mod10</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="nb">sum</span>
</code></pre></div>
<p>Notice that the <code>increment</code> tasks appears twice in the CWL workflow definition, being referenced twice in the python code above. 
This duplication can be avoided by explicitly indicating that the parameters are the same, with the <code>param</code> function.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">param</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">construct</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">increment</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Increment an integer.&quot;&quot;&quot;</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">double</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Double an integer.&quot;&quot;&quot;</span>
<span class="o">...</span>     <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">num</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">mod10</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Take num mod 10.&quot;&quot;&quot;</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Add two integers.&quot;&quot;&quot;</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">num</span> <span class="o">=</span> <span class="n">param</span><span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">left</span><span class="o">=</span><span class="n">double</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">increment</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">)),</span>
<span class="o">...</span>     <span class="n">right</span><span class="o">=</span><span class="n">mod10</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">increment</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">))</span>
<span class="o">...</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wkflw</span> <span class="o">=</span> <span class="n">construct</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">simplify_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cwl</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">wkflw</span><span class="p">)[</span><span class="s2">&quot;__root__&quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cwl</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">class</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">cwlVersion</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.2</span>
<span class="n">inputs</span><span class="p">:</span>
  <span class="n">num</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">3</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">num</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">outputs</span><span class="p">:</span>
  <span class="n">out</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">out</span>
    <span class="n">outputSource</span><span class="p">:</span> <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">steps</span><span class="p">:</span>
  <span class="n">double</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">num</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">increment</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">double</span>
  <span class="n">increment</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">num</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">num</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">increment</span>
  <span class="n">mod10</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">num</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">increment</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">mod10</span>
  <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">left</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">double</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
      <span class="n">right</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">mod10</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="nb">sum</span>
</code></pre></div>
<h2 id="parameters">Parameters</h2>
<p>The tool will spot global variables that you have used when building your tasks,
and treat them as parameters. It will try to get the type from the typehint, or
the value that you have set it to. This only works for basic types (and dict/lists of
those).</p>
<p>While global variables are implicit input to the Python function <strong>note that</strong>:</p>
<ol>
<li>in CWL, they will be rendered as explicit global input to a step</li>
<li>as input, they are read-only, and must not be updated</li>
</ol>
<p>For example:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">param</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">construct</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">INPUT_NUM</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>    <span class="s2">&quot;&quot;&quot;Rotate an integer.&quot;&quot;&quot;</span>
<span class="o">...</span>    <span class="k">return</span> <span class="p">(</span><span class="n">num</span> <span class="o">+</span> <span class="n">INPUT_NUM</span><span class="p">)</span> <span class="o">%</span> <span class="n">INPUT_NUM</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wkflw</span> <span class="o">=</span> <span class="n">construct</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">simplify_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cwl</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">wkflw</span><span class="p">)[</span><span class="s2">&quot;__root__&quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cwl</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">class</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">cwlVersion</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.2</span>
<span class="n">inputs</span><span class="p">:</span>
  <span class="n">INPUT_NUM</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">3</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">INPUT_NUM</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
  <span class="n">rotate</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">num</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">5</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">num</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">outputs</span><span class="p">:</span>
  <span class="n">out</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">out</span>
    <span class="n">outputSource</span><span class="p">:</span> <span class="n">rotate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">steps</span><span class="p">:</span>
  <span class="n">rotate</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">INPUT_NUM</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">INPUT_NUM</span>
      <span class="n">num</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">rotate</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">num</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">rotate</span>
</code></pre></div></p>
<h2 id="nested-tasks">Nested tasks</h2>
<p>When you wish to combine tasks together programmatically,
you can use nested tasks. These are run at <em>render</em> time, not
execution time. In other words, they do not appear in the
final graph, and so must only combine other tasks.</p>
<p>For example:</p>
<pre class="mermaid"><code>graph TD
    A[rotate] --&gt; B[rotate]
    B[rotate] --&gt; C[double_rotate]</code></pre>
<p>As code:</p>
<p><div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_configuration</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">construct</span><span class="p">,</span> <span class="n">workflow</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">INPUT_NUM</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Rotate an integer.&quot;&quot;&quot;</span>
<span class="o">...</span>     <span class="k">return</span> <span class="p">(</span><span class="n">num</span> <span class="o">+</span> <span class="n">INPUT_NUM</span><span class="p">)</span> <span class="o">%</span> <span class="n">INPUT_NUM</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@workflow</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">double_rotate</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Rotate an integer twice.&quot;&quot;&quot;</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">rotate</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">rotate</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">set_configuration</span><span class="p">(</span><span class="n">flatten_all_nested</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">double_rotate</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">wkflw</span> <span class="o">=</span> <span class="n">construct</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">simplify_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">cwl</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">wkflw</span><span class="p">)[</span><span class="s2">&quot;__root__&quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cwl</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">class</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">cwlVersion</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.2</span>
<span class="n">inputs</span><span class="p">:</span>
  <span class="n">INPUT_NUM</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">3</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">INPUT_NUM</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
  <span class="n">num</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">3</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">num</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">outputs</span><span class="p">:</span>
  <span class="n">out</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">out</span>
    <span class="n">outputSource</span><span class="p">:</span> <span class="n">rotate</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">steps</span><span class="p">:</span>
  <span class="n">rotate</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">INPUT_NUM</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">INPUT_NUM</span>
      <span class="n">num</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">rotate</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">out</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">rotate</span>
  <span class="n">rotate</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">INPUT_NUM</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">INPUT_NUM</span>
      <span class="n">num</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">num</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">rotate</span>
</code></pre></div>
Note that, as with all dewret calculations, only the steps
necessary to achieve the ultimate output are included in the final
graph. Therefore, nested tasks must return a step execution
(task that is being called) that forces any other calculations
you wish to happen. <strong>In other words, if a task in a
nested task does not have an impact on the return value,
it will disappear</strong>.
For example, the following code renders the same workflow as in the previous example:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@workflow</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">double_rotate</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;Rotate an integer twice.&quot;&quot;&quot;</span>
   <span class="n">unused_var</span> <span class="o">=</span> <span class="n">increment</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">rotate</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">rotate</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">))</span>
</code></pre></div>
<h2 id="step-output-fields">Step Output Fields</h2>
<p>Each step, by default, is treated as having
a single result. However, we allow a mechanism
for specifying multiple fields, using <code>attrs</code> or <code>dataclasses</code>.</p>
<p>Where needed, fields can be accessed outside of tasks
by dot notation and dewret will map that access to a
specific output field in CWL.</p>
<p>Note that in the example below, <code>shuffle</code> is still
only seen once in the graph:</p>
<pre class="mermaid"><code>graph TD
    A[shuffle] --&gt; B[hearts]
    A[shuffle] --&gt; C[diamonds]
    B[hearts] --&gt; D[sum]
    C[diamonds] --&gt; D[sum]</code></pre>
<p>As code:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">attrs</span><span class="w"> </span><span class="kn">import</span> <span class="n">define</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">random</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">construct</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@define</span>
<span class="o">...</span> <span class="k">class</span><span class="w"> </span><span class="nc">PackResult</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">hearts</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">clubs</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">spades</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">diamonds</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PackResult</span><span class="p">:</span>
<span class="o">...</span>    <span class="s2">&quot;&quot;&quot;Fill a random pile from a card deck, suit by suit.&quot;&quot;&quot;</span>
<span class="o">...</span>    <span class="k">return</span> <span class="n">PackResult</span><span class="p">(</span>
<span class="o">...</span>        <span class="n">hearts</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">clubs</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">spades</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">diamonds</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">)</span>
<span class="o">...</span>    <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>    <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">red_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">left</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">hearts</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">right</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">diamonds</span>
<span class="o">...</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wkflw</span> <span class="o">=</span> <span class="n">construct</span><span class="p">(</span><span class="n">red_total</span><span class="p">,</span> <span class="n">simplify_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cwl</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">wkflw</span><span class="p">)[</span><span class="s2">&quot;__root__&quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cwl</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">class</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">cwlVersion</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.2</span>
<span class="n">inputs</span><span class="p">:</span>
  <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">max_cards_per_suit</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">13</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">max_cards_per_suit</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">outputs</span><span class="p">:</span>
  <span class="n">out</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">out</span>
    <span class="n">outputSource</span><span class="p">:</span> <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">steps</span><span class="p">:</span>
  <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">max_cards_per_suit</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">max_cards_per_suit</span>
    <span class="n">out</span><span class="p">:</span>
      <span class="n">clubs</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">clubs</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">diamonds</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">diamonds</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">hearts</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">hearts</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">spades</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">spades</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">shuffle</span>
  <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">left</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">hearts</span>
      <span class="n">right</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">diamonds</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="nb">sum</span>
</code></pre></div>
<p>Here, we show the same example with <code>dataclasses</code>.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">random</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">construct</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@dataclass</span>
<span class="o">...</span> <span class="k">class</span><span class="w"> </span><span class="nc">PackResult</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">hearts</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">clubs</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">spades</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">diamonds</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PackResult</span><span class="p">:</span>
<span class="o">...</span>    <span class="s2">&quot;&quot;&quot;Fill a random pile from a card deck, suit by suit.&quot;&quot;&quot;</span>
<span class="o">...</span>    <span class="k">return</span> <span class="n">PackResult</span><span class="p">(</span>
<span class="o">...</span>        <span class="n">hearts</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">clubs</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">spades</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">diamonds</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">)</span>
<span class="o">...</span>    <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>    <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">red_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">left</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">hearts</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">right</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">diamonds</span>
<span class="o">...</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wkflw</span> <span class="o">=</span> <span class="n">construct</span><span class="p">(</span><span class="n">red_total</span><span class="p">,</span> <span class="n">simplify_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cwl</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">wkflw</span><span class="p">)[</span><span class="s2">&quot;__root__&quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cwl</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">class</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">cwlVersion</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.2</span>
<span class="n">inputs</span><span class="p">:</span>
  <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">max_cards_per_suit</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">13</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">max_cards_per_suit</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">outputs</span><span class="p">:</span>
  <span class="n">out</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">out</span>
    <span class="n">outputSource</span><span class="p">:</span> <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">steps</span><span class="p">:</span>
  <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">max_cards_per_suit</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">max_cards_per_suit</span>
    <span class="n">out</span><span class="p">:</span>
      <span class="n">clubs</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">clubs</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">diamonds</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">diamonds</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">hearts</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">hearts</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">spades</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">spades</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">shuffle</span>
  <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">left</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">hearts</span>
      <span class="n">right</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">diamonds</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="nb">sum</span>
</code></pre></div>
<h2 id="subworkflow">Subworkflow</h2>
<p>A special form of nested task is available to help divide up
more complex workflows: the <em>subworkflow</em>. By wrapping logic in subflows,
dewret will produce multiple output workflows that reference each other.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">attrs</span><span class="w"> </span><span class="kn">import</span> <span class="n">define</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">random</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">construct</span><span class="p">,</span> <span class="n">workflow</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@define</span>
<span class="o">...</span> <span class="k">class</span><span class="w"> </span><span class="nc">PackResult</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">hearts</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">clubs</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">spades</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">diamonds</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>    <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PackResult</span><span class="p">:</span>
<span class="o">...</span>    <span class="s2">&quot;&quot;&quot;Fill a random pile from a card deck, suit by suit.&quot;&quot;&quot;</span>
<span class="o">...</span>    <span class="k">return</span> <span class="n">PackResult</span><span class="p">(</span>
<span class="o">...</span>        <span class="n">hearts</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">clubs</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">spades</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">diamonds</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">)</span>
<span class="o">...</span>    <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@workflow</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">red_total</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
<span class="o">...</span>         <span class="n">left</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">hearts</span><span class="p">,</span>
<span class="o">...</span>         <span class="n">right</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">diamonds</span>
<span class="o">...</span>     <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@workflow</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">black_total</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
<span class="o">...</span>         <span class="n">left</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">spades</span><span class="p">,</span>
<span class="o">...</span>         <span class="n">right</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">clubs</span>
<span class="o">...</span>     <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">red_total</span><span class="p">(),</span> <span class="n">right</span><span class="o">=</span><span class="n">black_total</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wkflw</span> <span class="o">=</span> <span class="n">construct</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">simplify_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cwl</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">wkflw</span><span class="p">)[</span><span class="s2">&quot;__root__&quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cwl</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">class</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">cwlVersion</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.2</span>
<span class="n">inputs</span><span class="p">:</span> <span class="p">{}</span>
<span class="n">outputs</span><span class="p">:</span>
  <span class="n">out</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">out</span>
    <span class="n">outputSource</span><span class="p">:</span> <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">steps</span><span class="p">:</span>
  <span class="n">black_total</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span> <span class="p">{}</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">black_total</span>
  <span class="n">red_total</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span> <span class="p">{}</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">red_total</span>
  <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">left</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">red_total</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
      <span class="n">right</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">black_total</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="nb">sum</span>
</code></pre></div>
<p>As we have used subworkflow to wrap the colour totals, the outer workflow
contains references to them only. The subworkflows are now returned by <code>render</code>
as a second term.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">attrs</span><span class="w"> </span><span class="kn">import</span> <span class="n">define</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">random</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">construct</span><span class="p">,</span> <span class="n">workflow</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@define</span>
<span class="o">...</span> <span class="k">class</span><span class="w"> </span><span class="nc">PackResult</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">hearts</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">clubs</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">spades</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">diamonds</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PackResult</span><span class="p">:</span>
<span class="o">...</span>    <span class="s2">&quot;&quot;&quot;Fill a random pile from a card deck, suit by suit.&quot;&quot;&quot;</span>
<span class="o">...</span>    <span class="k">return</span> <span class="n">PackResult</span><span class="p">(</span>
<span class="o">...</span>        <span class="n">hearts</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">clubs</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">spades</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">),</span>
<span class="o">...</span>        <span class="n">diamonds</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="p">)</span>
<span class="o">...</span>    <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>    <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@workflow</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">red_total</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
<span class="o">...</span>         <span class="n">left</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">hearts</span><span class="p">,</span>
<span class="o">...</span>         <span class="n">right</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">diamonds</span>
<span class="o">...</span>     <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@workflow</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">black_total</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
<span class="o">...</span>         <span class="n">left</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">spades</span><span class="p">,</span>
<span class="o">...</span>         <span class="n">right</span><span class="o">=</span><span class="n">shuffle</span><span class="p">(</span><span class="n">max_cards_per_suit</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">clubs</span>
<span class="o">...</span>     <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">red_total</span><span class="p">(),</span> <span class="n">right</span><span class="o">=</span><span class="n">black_total</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wkflw</span> <span class="o">=</span> <span class="n">construct</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">simplify_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cwl</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">wkflw</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cwl</span><span class="p">[</span><span class="s2">&quot;red_total-1&quot;</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">class</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">cwlVersion</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.2</span>
<span class="n">inputs</span><span class="p">:</span> <span class="p">{}</span>
<span class="n">outputs</span><span class="p">:</span>
  <span class="n">out</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">out</span>
    <span class="n">outputSource</span><span class="p">:</span> <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">steps</span><span class="p">:</span>
  <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">max_cards_per_suit</span><span class="p">:</span>
        <span class="n">default</span><span class="p">:</span> <span class="mi">13</span>
    <span class="n">out</span><span class="p">:</span>
      <span class="n">clubs</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">clubs</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">diamonds</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">diamonds</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">hearts</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">hearts</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">spades</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">spades</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">shuffle</span>
  <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">left</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">hearts</span>
      <span class="n">right</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">shuffle</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">diamonds</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="nb">sum</span>
</code></pre></div>
<h2 id="input-factories">Input Factories</h2>
<p>Sometimes we want to take complex Python input, not just raw types.
Not all serialization support this, but the <code>factory</code> function lets us
wrap a simple call, usually a constructor, that takes <em>only</em> raw arguments.
This can then rendered as either a step or a parameter depending on whether
the chosen renderer has the capability.</p>
<p>Below is the default output, treating <code>Pack</code> as a task.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">construct</span><span class="p">,</span> <span class="n">task</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">attrs</span><span class="w"> </span><span class="kn">import</span> <span class="n">define</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@define</span>
<span class="o">...</span> <span class="k">class</span><span class="w"> </span><span class="nc">PackResult</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">hearts</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">clubs</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">spades</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">diamonds</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Pack</span> <span class="o">=</span> <span class="n">factory</span><span class="p">(</span><span class="n">PackResult</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>    <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@workflow</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">black_total</span><span class="p">(</span><span class="n">pack</span><span class="p">:</span> <span class="n">PackResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
<span class="o">...</span>         <span class="n">left</span><span class="o">=</span><span class="n">pack</span><span class="o">.</span><span class="n">spades</span><span class="p">,</span>
<span class="o">...</span>         <span class="n">right</span><span class="o">=</span><span class="n">pack</span><span class="o">.</span><span class="n">clubs</span>
<span class="o">...</span>     <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pack</span> <span class="o">=</span> <span class="n">Pack</span><span class="p">(</span><span class="n">hearts</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">spades</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">diamonds</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">clubs</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wkflw</span> <span class="o">=</span> <span class="n">construct</span><span class="p">(</span><span class="n">black_total</span><span class="p">(</span><span class="n">pack</span><span class="o">=</span><span class="n">pack</span><span class="p">),</span> <span class="n">simplify_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cwl</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">wkflw</span><span class="p">)[</span><span class="s2">&quot;__root__&quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cwl</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">class</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">cwlVersion</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.2</span>
<span class="n">inputs</span><span class="p">:</span>
  <span class="n">PackResult</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">clubs</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">13</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">clubs</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
  <span class="n">PackResult</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">diamonds</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">13</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">diamonds</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
  <span class="n">PackResult</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">hearts</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">13</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">hearts</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
  <span class="n">PackResult</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">spades</span><span class="p">:</span>
    <span class="n">default</span><span class="p">:</span> <span class="mi">13</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">spades</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">outputs</span><span class="p">:</span>
  <span class="n">out</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">out</span>
    <span class="n">outputSource</span><span class="p">:</span> <span class="n">black_total</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">steps</span><span class="p">:</span>
  <span class="n">PackResult</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">clubs</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">PackResult</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">clubs</span>
      <span class="n">diamonds</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">PackResult</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">diamonds</span>
      <span class="n">hearts</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">PackResult</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">hearts</span>
      <span class="n">spades</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">PackResult</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">spades</span>
    <span class="n">out</span><span class="p">:</span>
      <span class="n">clubs</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">clubs</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">diamonds</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">diamonds</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">hearts</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">hearts</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
      <span class="n">spades</span><span class="p">:</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">spades</span>
        <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">PackResult</span>
  <span class="n">black_total</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">pack</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">PackResult</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">black_total</span>
</code></pre></div>
<p>The CWL renderer is also able to treat <code>pack</code> as a parameter, if complex
types are allowed.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">construct</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">attrs</span><span class="w"> </span><span class="kn">import</span> <span class="n">define</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dewret.renderers.cwl</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@define</span>
<span class="o">...</span> <span class="k">class</span><span class="w"> </span><span class="nc">PackResult</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">hearts</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">clubs</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">spades</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">...</span>     <span class="n">diamonds</span><span class="p">:</span> <span class="nb">int</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Pack</span> <span class="o">=</span> <span class="n">factory</span><span class="p">(</span><span class="n">PackResult</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@task</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>    <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@workflow</span><span class="p">()</span>
<span class="o">...</span> <span class="k">def</span><span class="w"> </span><span class="nf">black_total</span><span class="p">(</span><span class="n">pack</span><span class="p">:</span> <span class="n">PackResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
<span class="o">...</span>         <span class="n">left</span><span class="o">=</span><span class="n">pack</span><span class="o">.</span><span class="n">spades</span><span class="p">,</span>
<span class="o">...</span>         <span class="n">right</span><span class="o">=</span><span class="n">pack</span><span class="o">.</span><span class="n">clubs</span>
<span class="o">...</span>     <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pack</span> <span class="o">=</span> <span class="n">Pack</span><span class="p">(</span><span class="n">hearts</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">spades</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">diamonds</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">clubs</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wkflw</span> <span class="o">=</span> <span class="n">construct</span><span class="p">(</span><span class="n">black_total</span><span class="p">(</span><span class="n">pack</span><span class="o">=</span><span class="n">pack</span><span class="p">),</span> <span class="n">simplify_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cwl</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">wkflw</span><span class="p">,</span> <span class="n">allow_complex_types</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">factories_as_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;black_total-1&quot;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cwl</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">class</span><span class="p">:</span> <span class="n">Workflow</span>
<span class="n">cwlVersion</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.2</span>
<span class="n">inputs</span><span class="p">:</span>
  <span class="n">pack</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">pack</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">record</span>
<span class="n">outputs</span><span class="p">:</span>
  <span class="n">out</span><span class="p">:</span>
    <span class="n">label</span><span class="p">:</span> <span class="n">out</span>
    <span class="n">outputSource</span><span class="p">:</span> <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">out</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">steps</span><span class="p">:</span>
  <span class="nb">sum</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="ow">in</span><span class="p">:</span>
      <span class="n">left</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">pack</span><span class="o">/</span><span class="n">spades</span>
      <span class="n">right</span><span class="p">:</span>
        <span class="n">source</span><span class="p">:</span> <span class="n">pack</span><span class="o">/</span><span class="n">clubs</span>
    <span class="n">out</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">out</span>
    <span class="n">run</span><span class="p">:</span> <span class="nb">sum</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        
<footer class="md-footer">
    
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../renderers/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Renderers" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Renderers
              </div>
            </div>
          </a>
        
        
          
          <a href="../../reference/dewret/annotations/" class="md-footer__link md-footer__link--next" aria-label="Next: Annotations" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Annotations
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
            
            Powered by
            <a href="http://timothycrosley.github.io/portray">portray.</a>
            You too can
            <a href="http://timothycrosley.github.io/portray">
              portray</a>
            your Python project well using automatic documentation.
          </div>
        
      </div>
    </div>
  </footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>